<template>
	<div class="tempWrapper" style="padding: 10px 10%">
		<div class="bezierContainer">
			<svg
				:viewBox="setViewbox"
				aria-labelledby="title desc"
				class="bezier"
				@mouseleave="resetListener"
				@mouseup="resetListener"
				@mousemove="mouseTrack"
			>
				<title id="title">Bezier Generator tool</title>
				<desc id="desc">
					interactive tool for making a custom bezier generator
				</desc>

				<g class="bezier-chart" ref="mainChart">
					<rect
						:height="chartHeight"
						:width="chartWidth"
						y="0"
						x="0"
						stroke="blue"
						fill="#fff"
					/>
					<g class="bezier-chart-inner">
						<rect v-bind="innerChartAttrs" ref="innerChart" />
						<path
							:d="bezierDrawPath"
							stroke="black"
							fill="none"
							stroke-width="2"
						/>
						<line
							x1="0"
							y1="300"
							:x2="point1.x"
							:y2="point1.y"
							:stroke-width="lines.width"
							:stroke="lines.stroke"
						/>
						<circle
							:cx="point1.x"
							:cy="point1.y"
							:r="points.radius"
							class="bezier-chart-inner-point1"
							@mousedown="mouseClickPoint1(true)"
							:fill="themeColours.lightRed"
						/>
						<line
							x1="200"
							y1="100"
							:x2="point2.x"
							:y2="point2.y"
							stroke-width="1"
							:stroke="lines.stroke"
						/>
						<circle
							:cx="point2.x"
							:cy="point2.y"
							:r="points.radius"
							class="bezier-chart-inner-point2"
							@mousedown="mouseClickPoint2(true)"
							:fill="themeColours.midgrey"
						/>
					</g>
				</g>
			</svg>

			<div class="bezierContainer-info">
				<div class="mb-3">
					Animation speed:
					<div class="bezierContainer-info-speed">
						<input
							type="range"
							min="100"
							max="1500"
							v-model="animationSpeed"
							step="10"
						/>
						<span>{{ animationSpeed }}ms</span>
					</div>
				</div>
				<div class="mb-3">
					Cubic Bezier: ({{ bezierTextConstructor }})
				</div>
				<div class="mb-3">
					<button
						:style="demoButtomStyle"
						class="bezierContainer-info-button"
					>
						HOVER
					</button>
				</div>
				<div class="mb-3">
					Choose preset:
					<select @change="selectPreset">
						<option disabled selected>Select</option>
						<option value="0.12,0,0.39,0">easeInSine</option>
						<option value="0.61,1,0.88,1">easeOutSine</option>
						<option value="0.37,0,0.63,1">easeInOutSine</option>
						<option value="0.11,0,0.5,0">easeInQuad</option>
						<option value="0.5,1,0.89,1">easeOutQuad</option>
						<option value="0.45,0,0.55,1">easeInOutQuad</option>
						<option value="0.32,0,0.67,0">easeInCubic</option>
						<option value="0.33,1,0.68,1">easeOutCubic</option>
						<option value="0.65,0,0.35,1">easeInOutCubic</option>
						<option value="0.5,0,0.75,0">easeInQuart</option>
						<option value="0.25,1,0.5,1">easeOutQuart</option>
						<option value="0.76,0,0.24,1">easeInOutQuart</option>
						<option value="0.64,0,0.78,0">easeInQuint</option>
						<option value="0.22,1,0.36,1">easeOutQuint</option>
						<option value="0.83,0,0.17,1">easeInOutQuint</option>
						<option value="0.7,0,0.84,0">easeInExpo</option>
						<option value="0.16,1,0.3,1">easeOutExpo</option>
						<option value="0.87,0,0.13,1">easeInOutExpo</option>
						<option value="0.55,0,1,0.45">easeInCirc</option>
						<option value="0,0.55,0.45,1">easeOutCirc</option>
						<option value="0.85,0,0.15,1">easeInOutCirc</option>
						<option value="0.36,0,0.66,-0.56">easeInBack</option>
						<option value="0.34,1.56,0.64,1">easeOutBack</option>
						<option value="0.68,-0.6,0.32,1.6"
							>easeInOutBack</option
						>
					</select>
				</div>
			</div>
		</div>
	</div>
</template>

<script>
export default {
	props: ["bezierLiveVals"],
	emits: {
		"pass-bezier-values": function(vals) {
			if (vals) {
				return true;
			} else {
				console.log("no beziergen vals passed");
				return false;
			}
		},
	},
	data() {
		return {
			chartWidth: 200,
			chartHeight: 400, // changing this to more/less breaks it, need to make this flexible
			movePoint1: false,
			movePoint2: false,
			mouseXPos: 0,
			mouseYPos: 0,
			trackMouse: false,
			animationSpeed: 300,
			lines: {
				stroke: "#000000b0",
				width: "1",
			},
			points: {
				radius: 6,
			},
			point1: {
				x: 50,
				y: 250,
			},
			point2: {
				x: 150,
				y: 150,
			},
			bezier: {
				p1: "0.25",
				p2: "0.25",
				p3: "0.75",
				p4: "0.75",
			},
			themeColours: {
				darkgrey: "#2b2d42",
				midgrey: "#8d99ae",
				lightGrey: "#edf2f4",
				lightRed: "#ef233c",
				darkred: "#d90429",
			},
		};
	},
	computed: {
		bezierDrawPath() {
			const p1 = this.point1;
			const p2 = this.point2;
			return `M 0 300 C ${p1.x} ${p1.y}, ${p2.x} ${p2.y}, 200 100`;
		},
		bezierTextConstructor() {
			const b = this.bezier;
			return `${b.p1}, ${b.p2}, ${b.p3}, ${b.p4}`;
		},
		demoButtomStyle() {
			let style = `all ${this.animationSpeed}ms cubic-bezier(${this.bezierTextConstructor})`;
			return {
				transition: style,
			};
		},
		setViewbox() {
			return `0 0 ${this.chartWidth} ${this.chartHeight}`;
		},
		innerChartAttrs() {
			return {
				y: this.chartHeight / 2 - this.chartWidth / 2, // positioned in center
				x: "1",
				height: this.chartWidth,
				width: this.chartWidth - 2, //-2 to get the borders in
				fill: "#fff",
				stroke: "#000",
			};
		},
		chartOffset() {
			return {
				x: this.$refs.innerChart.getBoundingClientRect().left,
				innerY: this.$refs.innerChart.getBoundingClientRect().top,
				y: this.$refs.mainChart.getBoundingClientRect().top,
				width: this.$refs.innerChart.getBoundingClientRect().width,
				height: this.$refs.mainChart.getBoundingClientRect().height,
				innerHeight: this.$refs.innerChart.getBoundingClientRect()
					.height,
			};
		},
	},
	methods: {
		resetListener() {
			this.trackMouse = false;
			this.movePoint1 = false;
			this.movePoint2 = false;
		},
		mouseTrack(e) {
			// getting right cubix vals for points - y is more awkward since the offset is measure from the top, so its flipped
			if (this.trackMouse) {
				// set x point
				let xOffset = e.offsetX / this.chartOffset.width;
				let xBezierPoint = xOffset.toFixed(2);
				let setBezierPositionX =
					(e.offsetX / this.chartOffset.width) * this.chartWidth;
				// set y point
				let yOffset =
					this.chartOffset.height -
					e.offsetY -
					this.chartOffset.width / 2;
				let yBezierPoint = yOffset / this.chartOffset.innerHeight;
				let setBezierPositionY =
					(e.offsetY / this.chartOffset.height) * this.chartHeight;
				if (this.movePoint1) {
					this.bezier.p1 = xBezierPoint;
					this.point1.x = setBezierPositionX;
					this.bezier.p2 = yBezierPoint.toFixed(2);
					this.point1.y = setBezierPositionY;
				} else if (this.movePoint2) {
					this.bezier.p3 = xBezierPoint;
					this.point2.x = setBezierPositionX;
					this.bezier.p4 = yBezierPoint.toFixed(2);
					this.point2.y = setBezierPositionY;
				}
				this.$emit("pass-bezier-values", this.emitBezierVals());
			}
		},
		mouseClickPoint1(bool) {
			this.movePoint1 = bool;
			this.trackMouse = true;
		},
		mouseClickPoint2(bool) {
			this.movePoint2 = bool;
			this.trackMouse = true;
		},
		selectPreset(e) {
			const chosenValue = e.target.value.split(",");
			// set bezier text
			this.bezier = {
				p1: chosenValue[0],
				p2: chosenValue[1],
				p3: chosenValue[2],
				p4: chosenValue[3],
			};
			// set points in graph
			this.point1.x = chosenValue[0] * this.chartWidth;
			this.point1.y =
				this.chartWidth * 1.5 -
				this.innerChartAttrs.height * chosenValue[1];
			this.point2.x = chosenValue[2] * this.chartWidth;
			this.point2.y =
				this.chartWidth * 1.5 -
				this.innerChartAttrs.height * chosenValue[3];
		},
		emitBezierVals() {
			return {
				bezierPoints: this.bezier,
				speed: this.animationSpeed,
			};
		},
	},
};
</script>

<!-- Use preprocessors via the lang attribute! e.g. <style lang="scss"> -->
<style lang="scss" scoped>
.bezierContainer {
	position: relative;
	svg {
		width: 50%;
	}
	&-info {
		position: absolute;
		height: auto;
		width: 45%;
		top: 50%;
		right: 0;
		transform: translateY(-50%);
		&-button {
			display: block;
			position: relative;
			padding: 10px 80px;
			border: 1px solid rgba(0, 0, 0, 0.4);
			border-radius: 8px;
			text-transform: uppercase;
			overflow: hidden;
			margin: 15px 0;
			letter-spacing: 1px;
			font-size: 14px;
			&::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				height: 100%;
				width: 0;
				background: #48bfe3;
				transition: inherit;
			}
			&:hover,
			&:focus {
				color: transparent;
				&::before {
					width: 100%;
				}
			}
		}
		&-speed {
		}
	}
}
</style>
